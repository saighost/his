!function(e){function t(t){var n=e.data(t,"treegrid"),i=n.options;e(t).datagrid(e.extend({},i,{url:null,data:null,loader:function(){return!1},onBeforeLoad:function(){return!1},onLoadSuccess:function(){},onResizeColumn:function(e,n){r(t),i.onResizeColumn.call(t,e,n)},onBeforeSortColumn:function(e,r){if(0==i.onBeforeSortColumn.call(t,e,r))return!1},onSortColumn:function(r,n){if(i.sortName=r,i.sortOrder=n,i.remoteSort)g(t);else{var d=e(t).treegrid("getData");u(t,null,d)}i.onSortColumn.call(t,r,n)},onClickCell:function(e,r){i.onClickCell.call(t,r,C(t,e))},onDblClickCell:function(e,r){i.onDblClickCell.call(t,r,C(t,e))},onRowContextMenu:function(e,r){i.onContextMenu.call(t,e,C(t,r))}}));var d=e.data(t,"datagrid").options;if(i.columns=d.columns,i.frozenColumns=d.frozenColumns,n.dc=e.data(t,"datagrid").dc,i.pagination){var a=e(t).datagrid("getPager");a.pagination({pageNumber:i.pageNumber,pageSize:i.pageSize,pageList:i.pageList,onSelectPage:function(e,r){i.pageNumber=e,i.pageSize=r,g(t)}}),i.pageSize=a.pagination("options").pageSize}}function r(t,r){function n(e){var r=i.finder.getTr(t,e,"body",1),n=i.finder.getTr(t,e,"body",2);r.css("height",""),n.css("height","");var d=Math.max(r.height(),n.height());r.css("height",d),n.css("height",d)}var i=e.data(t,"datagrid").options,d=e.data(t,"datagrid").dc;if(!d.body1.is(":empty")&&(!i.nowrap||i.autoRowHeight)&&void 0!=r)for(var a=k(t,r),o=0;o<a.length;o++)n(a[o][i.idField]);e(t).datagrid("fixRowHeight",r)}function n(t){var r=e.data(t,"datagrid").dc,n=e.data(t,"treegrid").options;n.rownumbers&&r.body1.find("div.datagrid-cell-rownumber").each(function(t){e(this).html(t+1)})}function i(t){return function(r){e.fn.datagrid.defaults.rowEvents[t?"mouseover":"mouseout"](r);var n=e(r.target),i=t?"addClass":"removeClass";n.hasClass("tree-hit")&&(n.hasClass("tree-expanded")?n[i]("tree-expanded-hover"):n[i]("tree-collapsed-hover"))}}function d(t){function r(e){var t=n.closest("tr.datagrid-row"),r=t.closest("div.datagrid-view").children(".datagrid-f")[0];e(r,t.attr("node-id"))}var n=e(t.target);n.hasClass("tree-hit")?r(y):n.hasClass("tree-checkbox")?r(a):e.fn.datagrid.defaults.rowEvents.click(t)}function a(t,r,n,i){var d=e.data(t,"treegrid"),a=(d.checkedRows,d.options);if(a.checkbox){var s=C(t,r);if(s.checkState){var h=a.finder.getTr(t,r),f=h.find(".tree-checkbox");if(void 0==n&&(f.hasClass("tree-checkbox1")?n=!1:f.hasClass("tree-checkbox0")?n=!0:(void 0==s._checked&&(s._checked=f.hasClass("tree-checkbox1")),n=!s._checked)),s._checked=n,n){if(f.hasClass("tree-checkbox1"))return}else if(f.hasClass("tree-checkbox0"))return;(i||0!=a.onBeforeCheckNode.call(t,s,n))&&(a.cascadeCheck?(c(t,s,n),l(t,s)):o(t,s,n?"1":"0"),i||a.onCheckNode.call(t,s,n))}}}function o(t,r,n){var i=e.data(t,"treegrid"),d=i.checkedRows,a=i.options;if(r.checkState&&void 0!=n){var o=a.finder.getTr(t,r[a.idField]),c=o.find(".tree-checkbox");c.length&&(r.checkState=["unchecked","checked","indeterminate"][n],r.checked="checked"==r.checkState,c.removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2"),c.addClass("tree-checkbox"+n),0==n?e.easyui.removeArrayItem(d,a.idField,r[a.idField]):e.easyui.addArrayItem(d,a.idField,r))}}function c(t,r,n){var i=n?1:0;o(t,r,i),e.easyui.forEach(r.children||[],!0,function(e){o(t,e,i)})}function l(t,r){var n=e.data(t,"treegrid").options,i=m(t,r[n.idField]);i&&(o(t,i,s(i)),l(t,i))}function s(t){var r=0,n=0,i=0;if(e.easyui.forEach(t.children||[],!1,function(e){e.checkState&&(r++,"checked"==e.checkState?i++:"unchecked"==e.checkState&&n++)}),0!=r){var d=0;return d=n==r?0:i==r?1:2}}function h(t,r){var n=e.data(t,"treegrid").options;if(n.checkbox){var i=C(t,r),d=n.finder.getTr(t,r),o=d.find(".tree-checkbox");if(n.view.hasCheckbox(t,i))if(o.length||(i.checkState=i.checkState||"unchecked",e('<span class="tree-checkbox"></span>').insertBefore(d.find(".tree-title"))),"checked"==i.checkState)a(t,r,!0,!0);else if("unchecked"==i.checkState)a(t,r,!1,!0);else{var c=s(i);0===c?a(t,r,!1,!0):1===c&&a(t,r,!0,!0)}else o.remove(),i.checkState=void 0,i.checked=void 0,l(t,i)}}function f(t,r){function n(t,r){e('<tr class="treegrid-tr-tree"><td style="border:0px" colspan="'+r+'"><div></div></td></tr>').insertAfter(t)}var i=e.data(t,"treegrid").options,d=i.finder.getTr(t,r,"body",1),a=i.finder.getTr(t,r,"body",2),o=e(t).datagrid("getColumnFields",!0).length+(i.rownumbers?1:0),c=e(t).datagrid("getColumnFields",!1).length;n(d,o),n(a,c)}function u(t,i,d,a,o){var c=e.data(t,"treegrid"),l=c.options,s=c.dc;d=l.loadFilter.call(t,d,i);var h=C(t,i);if(h){var f=l.finder.getTr(t,i,"body",1),u=l.finder.getTr(t,i,"body",2),g=f.next("tr.treegrid-tr-tree").children("td").children("div"),p=u.next("tr.treegrid-tr-tree").children("td").children("div");a||(h.children=[])}else{var g=s.body1,p=s.body2;a||(c.data=[])}if(a||(g.empty(),p.empty()),l.view.onBeforeRender&&l.view.onBeforeRender.call(l.view,t,i,d),l.view.render.call(l.view,t,g,!0),l.view.render.call(l.view,t,p,!1),l.showFooter&&(l.view.renderFooter.call(l.view,t,s.footer1,!0),l.view.renderFooter.call(l.view,t,s.footer2,!1)),l.view.onAfterRender&&l.view.onAfterRender.call(l.view,t),!i&&l.pagination){var v=e.data(t,"treegrid").total,m=e(t).datagrid("getPager");m.pagination("options").total!=v&&m.pagination({total:v})}r(t),n(t),e(t).treegrid("showLines"),e(t).treegrid("setSelectionState"),e(t).treegrid("autoSizeColumn"),o||l.onLoadSuccess.call(t,h,d)}function g(t,r,n,i,d){var a=e.data(t,"treegrid").options,o=e(t).datagrid("getPanel").find("div.datagrid-body");void 0==r&&a.queryParams&&(a.queryParams.id=void 0),n&&(a.queryParams=n);var c=e.extend({},a.queryParams);a.pagination&&e.extend(c,{page:a.pageNumber,rows:a.pageSize}),a.sortName&&e.extend(c,{sort:a.sortName,order:a.sortOrder});var l=C(t,r);if(0!=a.onBeforeLoad.call(t,l,c)){var s=o.find('tr[node-id="'+r+'"] span.tree-folder');s.addClass("tree-loading"),e(t).treegrid("loading");var h=a.loader.call(t,c,function(n){s.removeClass("tree-loading"),e(t).treegrid("loaded"),u(t,r,n,i),d&&d()},function(){s.removeClass("tree-loading"),e(t).treegrid("loaded"),a.onLoadError.apply(t,arguments),d&&d()});0==h&&(s.removeClass("tree-loading"),e(t).treegrid("loaded"))}}function p(e){var t=v(e);return t.length?t[0]:null}function v(t){return e.data(t,"treegrid").data}function m(e,t){var r=C(e,t);return r._parentId?C(e,r._parentId):null}function k(t,r){var n=e.data(t,"treegrid").data;if(r){var i=C(t,r);n=i?i.children||[]:[]}var d=[];return e.easyui.forEach(n,!0,function(e){d.push(e)}),d}function b(t,r){var n=e.data(t,"treegrid").options,i=n.finder.getTr(t,r),d=i.children('td[field="'+n.treeField+'"]');return d.find("span.tree-indent,span.tree-hit").length}function C(t,r){var n=e.data(t,"treegrid"),i=n.options,d=null;return e.easyui.forEach(n.data,!0,function(e){if(e[i.idField]==r)return d=e,!1}),d}function w(t,n){var i=e.data(t,"treegrid").options,d=C(t,n),a=i.finder.getTr(t,n),o=a.find("span.tree-hit");if(0!=o.length&&!o.hasClass("tree-collapsed")&&0!=i.onBeforeCollapse.call(t,d)){o.removeClass("tree-expanded tree-expanded-hover").addClass("tree-collapsed"),o.next().removeClass("tree-folder-open"),d.state="closed",a=a.next("tr.treegrid-tr-tree");var c=a.children("td").children("div");i.animate?c.slideUp("normal",function(){e(t).treegrid("autoSizeColumn"),r(t,n),i.onCollapse.call(t,d)}):(c.hide(),e(t).treegrid("autoSizeColumn"),r(t,n),i.onCollapse.call(t,d))}}function x(t,n){function i(i){c.state="open",d.animate?i.slideDown("normal",function(){e(t).treegrid("autoSizeColumn"),r(t,n),d.onExpand.call(t,c)}):(i.show(),e(t).treegrid("autoSizeColumn"),r(t,n),d.onExpand.call(t,c))}var d=e.data(t,"treegrid").options,a=d.finder.getTr(t,n),o=a.find("span.tree-hit"),c=C(t,n);if(0!=o.length&&!o.hasClass("tree-expanded")&&0!=d.onBeforeExpand.call(t,c)){o.removeClass("tree-collapsed tree-collapsed-hover").addClass("tree-expanded"),o.next().addClass("tree-folder-open");var l=a.next("tr.treegrid-tr-tree");if(l.length){var s=l.children("td").children("div");i(s)}else{f(t,c[d.idField]);var l=a.next("tr.treegrid-tr-tree"),s=l.children("td").children("div");s.hide();var h=e.extend({},d.queryParams||{});h.id=c[d.idField],g(t,c[d.idField],h,!0,function(){s.is(":empty")?l.remove():i(s)})}}}function y(t,r){var n=e.data(t,"treegrid").options,i=n.finder.getTr(t,r),d=i.find("span.tree-hit");d.hasClass("tree-expanded")?w(t,r):x(t,r)}function F(t,r){var n=e.data(t,"treegrid").options,i=k(t,r);r&&i.unshift(C(t,r));for(var d=0;d<i.length;d++)w(t,i[d][n.idField])}function S(t,r){var n=e.data(t,"treegrid").options,i=k(t,r);r&&i.unshift(C(t,r));for(var d=0;d<i.length;d++)x(t,i[d][n.idField])}function R(t,r){for(var n=e.data(t,"treegrid").options,i=[],d=m(t,r);d;){var a=d[n.idField];i.unshift(a),d=m(t,a)}for(var o=0;o<i.length;o++)x(t,i[o])}function T(t,r){var n=e.data(t,"treegrid").options;if(r.parent){var i=n.finder.getTr(t,r.parent);0==i.next("tr.treegrid-tr-tree").length&&f(t,r.parent);var d=i.children('td[field="'+n.treeField+'"]').children("div.datagrid-cell"),a=d.children("span.tree-icon");if(a.hasClass("tree-file")){a.removeClass("tree-file").addClass("tree-folder tree-folder-open");var o=e('<span class="tree-hit tree-expanded"></span>').insertBefore(a);o.prev().length&&o.prev().remove()}}u(t,r.parent,r.data,!0,!0)}function E(t,r){function i(e){var n=e?1:2,i=a.finder.getTr(t,r.data[a.idField],"body",n),o=i.closest("table.datagrid-btable");i=i.parent().children();var c=a.finder.getTr(t,d,"body",n);if(r.before)i.insertBefore(c);else{var l=c.next("tr.treegrid-tr-tree");i.insertAfter(l.length?l:c)}o.remove()}var d=r.before||r.after,a=e.data(t,"treegrid").options,o=m(t,d);T(t,{parent:o?o[a.idField]:null,data:[r.data]});for(var c=o?o.children:e(t).treegrid("getRoots"),l=0;l<c.length;l++)if(c[l][a.idField]==d){var s=c[c.length-1];c.splice(r.before?l:l+1,0,s),c.splice(c.length-1,1);break}i(!0),i(!1),n(t),e(t).treegrid("showLines")}function L(t,r){var i=e.data(t,"treegrid"),d=i.options,a=m(t,r);e(t).datagrid("deleteRow",r),e.easyui.removeArrayItem(i.checkedRows,d.idField,r),n(t),a&&h(t,a[d.idField]),i.total-=1,e(t).datagrid("getPager").pagination("refresh",{total:i.total}),e(t).treegrid("showLines")}function N(t){function r(t){if(e.map(t,function(e){if(e.children&&e.children.length)r(e.children);else{var t=i(e);t.find(".tree-icon").prev().addClass("tree-join")}}),t.length){var n=i(t[t.length-1]);n.addClass("tree-node-last"),n.find(".tree-join").removeClass("tree-join").addClass("tree-joinbottom")}}function n(r){e.map(r,function(e){e.children&&e.children.length&&n(e.children)});for(var i=0;i<r.length-1;i++){var o=r[i],c=d.treegrid("getLevel",o[a.idField]),l=a.finder.getTr(t,o[a.idField]),s=l.next().find('tr.datagrid-row td[field="'+a.treeField+'"] div.datagrid-cell');s.find("span:eq("+(c-1)+")").addClass("tree-line")}}function i(e){var r=a.finder.getTr(t,e[a.idField]),n=r.find('td[field="'+a.treeField+'"] div.datagrid-cell');return n}var d=e(t),a=d.treegrid("options");if(!a.lines)return void d.treegrid("getPanel").removeClass("tree-lines");d.treegrid("getPanel").addClass("tree-lines"),d.treegrid("getPanel").find("span.tree-indent").removeClass("tree-line tree-join tree-joinbottom"),d.treegrid("getPanel").find("div.datagrid-cell").removeClass("tree-node-last tree-root-first tree-root-one");var o=d.treegrid("getRoots");o.length>1?i(o[0]).addClass("tree-root-first"):1==o.length&&i(o[0]).addClass("tree-root-one"),r(o),n(o)}e.fn.treegrid=function(r,n){if("string"==typeof r){var i=e.fn.treegrid.methods[r];return i?i(this,n):this.datagrid(r,n)}return r=r||{},this.each(function(){var n=e.data(this,"treegrid");n?e.extend(n.options,r):n=e.data(this,"treegrid",{options:e.extend({},e.fn.treegrid.defaults,e.fn.treegrid.parseOptions(this),r),data:[],checkedRows:[],tmpIds:[]}),t(this),n.options.data&&e(this).treegrid("loadData",n.options.data),g(this)})},e.fn.treegrid.methods={options:function(t){return e.data(t[0],"treegrid").options},resize:function(t,r){return t.each(function(){e(this).datagrid("resize",r)})},fixRowHeight:function(e,t){return e.each(function(){r(this,t)})},loadData:function(e,t){return e.each(function(){u(this,t.parent,t)})},load:function(t,r){return t.each(function(){e(this).treegrid("options").pageNumber=1,e(this).treegrid("getPager").pagination({pageNumber:1}),e(this).treegrid("reload",r)})},reload:function(t,r){return t.each(function(){var t=e(this).treegrid("options"),n={};if("object"==typeof r?n=r:(n=e.extend({},t.queryParams),n.id=r),n.id){var i=e(this).treegrid("find",n.id);i.children&&i.children.splice(0,i.children.length),t.queryParams=n;var d=t.finder.getTr(this,n.id);d.next("tr.treegrid-tr-tree").remove(),d.find("span.tree-hit").removeClass("tree-expanded tree-expanded-hover").addClass("tree-collapsed"),x(this,n.id)}else g(this,null,n)})},reloadFooter:function(t,r){return t.each(function(){var t=e.data(this,"treegrid").options,n=e.data(this,"datagrid").dc;r&&(e.data(this,"treegrid").footer=r),t.showFooter&&(t.view.renderFooter.call(t.view,this,n.footer1,!0),t.view.renderFooter.call(t.view,this,n.footer2,!1),t.view.onAfterRender&&t.view.onAfterRender.call(t.view,this),e(this).treegrid("fixRowHeight"))})},getData:function(t){return e.data(t[0],"treegrid").data},getFooterRows:function(t){return e.data(t[0],"treegrid").footer},getRoot:function(e){return p(e[0])},getRoots:function(e){return v(e[0])},getParent:function(e,t){return m(e[0],t)},getChildren:function(e,t){return k(e[0],t)},getLevel:function(e,t){return b(e[0],t)},find:function(e,t){return C(e[0],t)},isLeaf:function(t,r){var n=e.data(t[0],"treegrid").options,i=n.finder.getTr(t[0],r),d=i.find("span.tree-hit");return 0==d.length},select:function(t,r){return t.each(function(){e(this).datagrid("selectRow",r)})},unselect:function(t,r){return t.each(function(){e(this).datagrid("unselectRow",r)})},collapse:function(e,t){return e.each(function(){w(this,t)})},expand:function(e,t){return e.each(function(){x(this,t)})},toggle:function(e,t){return e.each(function(){y(this,t)})},collapseAll:function(e,t){return e.each(function(){F(this,t)})},expandAll:function(e,t){return e.each(function(){S(this,t)})},expandTo:function(e,t){return e.each(function(){R(this,t)})},append:function(e,t){return e.each(function(){T(this,t)})},insert:function(e,t){return e.each(function(){E(this,t)})},remove:function(e,t){return e.each(function(){L(this,t)})},pop:function(e,t){var r=e.treegrid("find",t);return e.treegrid("remove",t),r},refresh:function(t,r){return t.each(function(){var t=e.data(this,"treegrid").options;t.view.refreshRow.call(t.view,this,r)})},update:function(t,r){return t.each(function(){var t=e.data(this,"treegrid").options,n=r.row;t.view.updateRow.call(t.view,this,r.id,n),void 0!=n.checked&&(n=C(this,r.id),e.extend(n,{checkState:n.checked?"checked":n.checked===!1?"unchecked":void 0}),h(this,r.id))})},beginEdit:function(t,r){return t.each(function(){e(this).datagrid("beginEdit",r),e(this).treegrid("fixRowHeight",r)})},endEdit:function(t,r){return t.each(function(){e(this).datagrid("endEdit",r)})},cancelEdit:function(t,r){return t.each(function(){e(this).datagrid("cancelEdit",r)})},showLines:function(e){return e.each(function(){N(this)})},setSelectionState:function(t){return t.each(function(){e(this).datagrid("setSelectionState");for(var t=e(this).data("treegrid"),r=0;r<t.tmpIds.length;r++)a(this,t.tmpIds[r],!0,!0);t.tmpIds=[]})},getCheckedNodes:function(t,r){r=r||"checked";var n=[];return e.easyui.forEach(t.data("treegrid").checkedRows,!1,function(e){e.checkState==r&&n.push(e)}),n},checkNode:function(e,t){return e.each(function(){a(this,t,!0)})},uncheckNode:function(e,t){return e.each(function(){a(this,t,!1)})},clearChecked:function(t){return t.each(function(){var t=this,r=e(t).treegrid("options");e(t).datagrid("clearChecked"),e.map(e(t).treegrid("getCheckedNodes"),function(e){a(t,e[r.idField],!1,!0)})})}},e.fn.treegrid.parseOptions=function(t){return e.extend({},e.fn.datagrid.parseOptions(t),e.parser.parseOptions(t,["treeField",{checkbox:"boolean",cascadeCheck:"boolean",onlyLeafCheck:"boolean"},{animate:"boolean"}]))};var P=e.extend({},e.fn.datagrid.defaults.view,{render:function(t,r,n){function i(r,n,l){for(var s=e(t).treegrid("getParent",l[0][d.idField]),h=(s?s.children.length:e(t).treegrid("getRoots").length)-l.length,f=['<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>'],u=0;u<l.length;u++){var g=l[u];"open"!=g.state&&"closed"!=g.state&&(g.state="open");var p=d.rowStyler?d.rowStyler.call(t,g):"",v=this.getStyleValue(p),m='class="datagrid-row '+(h++%2&&d.striped?"datagrid-row-alt ":" ")+v.c+'"',k=v.s?'style="'+v.s+'"':"",b=o+"-"+(r?1:2)+"-"+g[d.idField];if(f.push('<tr id="'+b+'" node-id="'+g[d.idField]+'" '+m+" "+k+">"),f=f.concat(c.renderRow.call(c,t,a,r,n,g)),f.push("</tr>"),g.children&&g.children.length){var C=i.call(this,r,n+1,g.children),w="closed"==g.state?"none":"block";f.push('<tr class="treegrid-tr-tree"><td style="border:0px" colspan='+(a.length+(d.rownumbers?1:0))+'><div style="display:'+w+'">'),f=f.concat(C),f.push("</div></td></tr>")}}return f.push("</tbody></table>"),f}var d=e.data(t,"treegrid").options,a=e(t).datagrid("getColumnFields",n),o=e.data(t,"datagrid").rowIdPrefix;if(!n||d.rownumbers||d.frozenColumns&&d.frozenColumns.length){var c=this;if(this.treeNodes&&this.treeNodes.length){var l=i.call(this,n,this.treeLevel,this.treeNodes);e(r).append(l.join(""))}}},renderFooter:function(t,r,n){for(var i=e.data(t,"treegrid").options,d=e.data(t,"treegrid").footer||[],a=e(t).datagrid("getColumnFields",n),o=['<table class="datagrid-ftable" cellspacing="0" cellpadding="0" border="0"><tbody>'],c=0;c<d.length;c++){var l=d[c];l[i.idField]=l[i.idField]||"foot-row-id"+c,o.push('<tr class="datagrid-row" node-id="'+l[i.idField]+'">'),o.push(this.renderRow.call(this,t,a,n,0,l)),o.push("</tr>")}o.push("</tbody></table>"),e(r).html(o.join(""))},renderRow:function(t,r,n,i,d){var a=e.data(t,"treegrid"),o=a.options,c=[];n&&o.rownumbers&&c.push('<td class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber">0</div></td>');for(var l=0;l<r.length;l++){var s=r[l],h=e(t).datagrid("getColumnOption",s);if(h){var f=h.styler?h.styler(d[s],d)||"":"",u=this.getStyleValue(f),g=u.c?'class="'+u.c+'"':"",p=h.hidden?'style="display:none;'+u.s+'"':u.s?'style="'+u.s+'"':"";c.push('<td field="'+s+'" '+g+" "+p+">");var p="";if(h.checkbox||(h.align&&(p+="text-align:"+h.align+";"),o.nowrap?o.autoRowHeight&&(p+="height:auto;"):p+="white-space:normal;height:auto;"),c.push('<div style="'+p+'" '),h.checkbox?c.push('class="datagrid-cell-check '):c.push('class="datagrid-cell '+h.cellClass),c.push('">'),h.checkbox)d.checked?c.push('<input type="checkbox" checked="checked"'):c.push('<input type="checkbox"'),c.push(' name="'+s+'" value="'+(void 0!=d[s]?d[s]:"")+'">');else{var v=null;if(v=h.formatter?h.formatter(d[s],d):d[s],s==o.treeField){for(var m=0;m<i;m++)c.push('<span class="tree-indent"></span>');if("closed"==d.state?(c.push('<span class="tree-hit tree-collapsed"></span>'),c.push('<span class="tree-icon tree-folder '+(d.iconCls?d.iconCls:"")+'"></span>')):d.children&&d.children.length?(c.push('<span class="tree-hit tree-expanded"></span>'),c.push('<span class="tree-icon tree-folder tree-folder-open '+(d.iconCls?d.iconCls:"")+'"></span>')):(c.push('<span class="tree-indent"></span>'),c.push('<span class="tree-icon tree-file '+(d.iconCls?d.iconCls:"")+'"></span>')),this.hasCheckbox(t,d)){var k=0,b=e.easyui.getArrayItem(a.checkedRows,o.idField,d[o.idField]);if(b)k="checked"==b.checkState?1:2;else{var C=e.easyui.getArrayItem(a.checkedRows,o.idField,d._parentId);C&&"checked"==C.checkState&&o.cascadeCheck?(k=1,d.checked=!0,e.easyui.addArrayItem(a.checkedRows,o.idField,d)):d.checked&&e.easyui.addArrayItem(a.tmpIds,d[o.idField]),d.checkState=k?"checked":"unchecked"}c.push('<span class="tree-checkbox tree-checkbox'+k+'"></span>')}else d.checkState=void 0,d.checked=void 0;c.push('<span class="tree-title">'+v+"</span>")}else c.push(v)}c.push("</div>"),c.push("</td>")}}return c.join("")},hasCheckbox:function(t,r){var n=e.data(t,"treegrid").options;if(n.checkbox){if(e.isFunction(n.checkbox))return!!n.checkbox.call(t,r);if(!n.onlyLeafCheck)return!0;if(!("open"!=r.state||r.children&&r.children.length))return!0}return!1},refreshRow:function(e,t){this.updateRow.call(this,e,t,{})},updateRow:function(t,r,n){function i(n){var i=e(t).treegrid("getColumnFields",n),h=d.finder.getTr(t,r,"body",n?1:2),f=h.find("div.datagrid-cell-rownumber").html(),u=h.find("div.datagrid-cell-check input[type=checkbox]").is(":checked");h.html(this.renderRow(t,i,n,o,a)),h.attr("style",c||""),h.find("div.datagrid-cell-rownumber").html(f),u&&h.find("div.datagrid-cell-check input[type=checkbox]")._propAttr("checked",!0),s!=r&&(h.attr("id",l+"-"+(n?1:2)+"-"+s),h.attr("node-id",s))}var d=e.data(t,"treegrid").options,a=e(t).treegrid("find",r);e.extend(a,n);var o=e(t).treegrid("getLevel",r)-1,c=d.rowStyler?d.rowStyler.call(t,a):"",l=e.data(t,"datagrid").rowIdPrefix,s=a[d.idField];i.call(this,!0),i.call(this,!1),e(t).treegrid("fixRowHeight",r)},deleteRow:function(t,r){function n(r){var n,d=e(t).treegrid("getParent",r);n=d?d.children:e(t).treegrid("getData");for(var a=0;a<n.length;a++)if(n[a][i.idField]==r){n.splice(a,1);break}return d}var i=e.data(t,"treegrid").options,d=i.finder.getTr(t,r);d.next("tr.treegrid-tr-tree").remove(),d.remove();var a=n(r);if(a&&0==a.children.length){d=i.finder.getTr(t,a[i.idField]),d.next("tr.treegrid-tr-tree").remove();var o=d.children('td[field="'+i.treeField+'"]').children("div.datagrid-cell");o.find(".tree-icon").removeClass("tree-folder").addClass("tree-file"),o.find(".tree-hit").remove(),e('<span class="tree-indent"></span>').prependTo(o)}},onBeforeRender:function(t,r,n){function i(e,t){for(var r=0;r<e.length;r++){var n=e[r];n._parentId=t,n.children&&n.children.length&&i(n.children,n[a.idField])}}if(e.isArray(r)&&(n={total:r.length,rows:r},r=null),!n)return!1;var d=e.data(t,"treegrid"),a=d.options;void 0==n.length?(n.footer&&(d.footer=n.footer),n.total&&(d.total=n.total),n=this.transfer(t,r,n.rows)):i(n,r);var o=C(t,r);o?o.children?o.children=o.children.concat(n):o.children=n:d.data=d.data.concat(n),this.sort(t,n),this.treeNodes=n,this.treeLevel=e(t).treegrid("getLevel",r)},sort:function(t,r){function n(r){r.sort(function(r,n){for(var i=0,o=0;o<d.length;o++){var c=d[o],l=a[o],s=e(t).treegrid("getColumnOption",c),h=s.sorter||function(e,t){return e==t?0:e>t?1:-1};if(i=h(r[c],n[c])*("asc"==l?1:-1),0!=i)return i}return i});for(var i=0;i<r.length;i++){var o=r[i].children;o&&o.length&&n(o)}}var i=e.data(t,"treegrid").options;if(!i.remoteSort&&i.sortName){var d=i.sortName.split(","),a=i.sortOrder.split(",");n(r)}},transfer:function(t,r,n){function i(e,t){for(var r=[],n=0;n<t.length;n++){var i=t[n];i._parentId==e&&(r.push(i),t.splice(n,1),n--)}return r}for(var d=e.data(t,"treegrid").options,a=e.extend([],n),o=i(r,a),c=e.extend([],o);c.length;){var l=c.shift(),s=i(l[d.idField],a);s.length&&(l.children?l.children=l.children.concat(s):l.children=s,c=c.concat(s))}return o}});e.fn.treegrid.defaults=e.extend({},e.fn.datagrid.defaults,{treeField:null,checkbox:!1,cascadeCheck:!0,onlyLeafCheck:!1,lines:!1,animate:!1,singleSelect:!0,view:P,rowEvents:e.extend({},e.fn.datagrid.defaults.rowEvents,{mouseover:i(!0),mouseout:i(!1),click:d}),loader:function(t,r,n){var i=e(this).treegrid("options");return!!i.url&&void e.ajax({type:i.method,url:i.url,data:t,dataType:"json",success:function(e){r(e)},error:function(){n.apply(this,arguments)}})},loadFilter:function(e,t){return e},finder:{getTr:function(t,r,n,i){n=n||"body",i=i||0;var d=e.data(t,"datagrid").dc;if(0==i){var a=e.data(t,"treegrid").options,o=a.finder.getTr(t,r,n,1),c=a.finder.getTr(t,r,n,2);return o.add(c)}if("body"==n){var l=e("#"+e.data(t,"datagrid").rowIdPrefix+"-"+i+"-"+r);return l.length||(l=(1==i?d.body1:d.body2).find('tr[node-id="'+r+'"]')),l}return"footer"==n?(1==i?d.footer1:d.footer2).find('tr[node-id="'+r+'"]'):"selected"==n?(1==i?d.body1:d.body2).find("tr.datagrid-row-selected"):"highlight"==n?(1==i?d.body1:d.body2).find("tr.datagrid-row-over"):"checked"==n?(1==i?d.body1:d.body2).find("tr.datagrid-row-checked"):"last"==n?(1==i?d.body1:d.body2).find("tr:last[node-id]"):"allbody"==n?(1==i?d.body1:d.body2).find("tr[node-id]"):"allfooter"==n?(1==i?d.footer1:d.footer2).find("tr[node-id]"):void 0},getRow:function(t,r){var n="object"==typeof r?r.attr("node-id"):r;return e(t).treegrid("find",n)},getRows:function(t){return e(t).treegrid("getChildren")}},onBeforeLoad:function(e,t){},onLoadSuccess:function(e,t){},onLoadError:function(){},onBeforeCollapse:function(e){},onCollapse:function(e){},onBeforeExpand:function(e){},onExpand:function(e){},onClickRow:function(e){},onDblClickRow:function(e){},onClickCell:function(e,t){},onDblClickCell:function(e,t){},onContextMenu:function(e,t){},onBeforeEdit:function(e){},onAfterEdit:function(e,t){},onCancelEdit:function(e){},onBeforeCheckNode:function(e,t){},onCheckNode:function(e,t){}})}(jQuery);