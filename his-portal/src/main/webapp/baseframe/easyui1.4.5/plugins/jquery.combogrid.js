!function(e){function t(t){function i(i,n){a.remainText=!1,o(),r.multiple||e(t).combo("hidePanel"),r.onClickRow.call(this,i,n)}function o(){var i=e.map(d.datagrid("getSelections"),function(e){return e[r.idField]});i=i.concat(r.unselectedValues),n(t,i,a.remainText)}var a=e.data(t,"combogrid"),r=a.options,d=a.grid;e(t).addClass("combogrid-f").combo(e.extend({},r,{onShowPanel:function(){var t=e(this).combogrid("panel"),i=t.outerHeight()-t.height(),n=t._size("minHeight"),o=t._size("maxHeight"),a=e(this).combogrid("grid");a.datagrid("resize",{width:"100%",height:isNaN(parseInt(r.panelHeight))?"auto":"100%",minHeight:n?n-i:"",maxHeight:o?o-i:""});var d=a.datagrid("getSelected");d&&a.datagrid("scrollTo",a.datagrid("getRowIndex",d)),r.onShowPanel.call(this)}}));var l=e(t).combo("panel");d||(d=e("<table></table>").appendTo(l),a.grid=d),d.datagrid(e.extend({},r,{border:!1,singleSelect:!r.multiple,onLoadSuccess:function(i){var o=e(t).combo("getValues"),d=r.onSelect;r.onSelect=function(){},n(t,o,a.remainText),r.onSelect=d,r.onLoadSuccess.apply(t,arguments)},onClickRow:i,onSelect:function(e,t){o(),r.onSelect.call(this,e,t)},onUnselect:function(e,t){o(),r.onUnselect.call(this,e,t)},onSelectAll:function(e){o(),r.onSelectAll.call(this,e)},onUnselectAll:function(e){r.multiple&&o(),r.onUnselectAll.call(this,e)}}))}function i(t,i){var n=e.data(t,"combogrid"),o=n.options,a=n.grid,r=a.datagrid("getRows").length;if(r){var d=o.finder.getTr(a[0],null,"highlight");d.length||(d=o.finder.getTr(a[0],null,"selected"));var l;if(d.length){var l=parseInt(d.attr("datagrid-row-index"));l+="next"==i?1:-1,l<0&&(l=r-1),l>=r&&(l=0)}else l="next"==i?0:r-1;a.datagrid("highlightRow",l),o.selectOnNavigation&&(n.remainText=!1,a.datagrid("selectRow",l))}}function n(t,i,n){function o(t,i){var n=e.easyui.getArrayItem(i,r.idField,t);return n?n[r.textField]:void 0}var a=e.data(t,"combogrid"),r=a.options,d=a.grid,l=e(t).combo("getValues"),s=e(t).combo("options"),c=s.onChange;s.onChange=function(){};var g=d.datagrid("options"),u=g.onSelect,h=g.onUnselectAll;g.onSelect=g.onUnselectAll=function(){},e.isArray(i)||(i=i.split(r.separator)),r.multiple||(i=i.length?[i[0]]:[""]);var f=e.map(i,function(e){return String(e)});f=e.grep(f,function(t,i){return i===e.inArray(t,f)});var m=e.grep(d.datagrid("getSelections"),function(t,i){return e.inArray(String(t[r.idField]),f)>=0});d.datagrid("clearSelections"),d.data("datagrid").selectedRows=m;var p=[];if(r.unselectedValues=[],e.map(f,function(e){var t=d.datagrid("getRowIndex",e);t>=0?d.datagrid("selectRow",t):r.unselectedValues.push(e),p.push(o(e,d.datagrid("getRows"))||o(e,m)||o(e,r.mappingRows)||e)}),e(t).combo("setValues",l),s.onChange=c,g.onSelect=u,g.onUnselectAll=h,!n){var b=p.join(r.separator);e(t).combo("getText")!=b&&e(t).combo("setText",b)}e(t).combo("setValues",i)}function o(t,i){var o=e.data(t,"combogrid"),a=o.options,r=o.grid;if(o.remainText=!0,a.multiple&&!i?n(t,[],!0):n(t,[i],!0),"remote"==a.mode)r.datagrid("clearSelections"),r.datagrid("load",e.extend({},a.queryParams,{q:i}));else{if(!i)return;r.datagrid("clearSelections").datagrid("highlightRow",-1);var d=r.datagrid("getRows"),l=a.multiple?i.split(a.separator):[i];e.map(l,function(i){i=e.trim(i),i&&e.map(d,function(e,n){i==e[a.textField]?r.datagrid("selectRow",n):a.filter.call(t,i,e)&&r.datagrid("highlightRow",n)})})}}function a(t){var i=e.data(t,"combogrid"),n=i.options,o=i.grid,a=n.finder.getTr(o[0],null,"highlight");if(i.remainText=!1,a.length){var r=parseInt(a.attr("datagrid-row-index"));n.multiple&&a.hasClass("datagrid-row-selected")?o.datagrid("unselectRow",r):o.datagrid("selectRow",r)}var d=[];e.map(o.datagrid("getSelections"),function(e){d.push(e[n.idField])}),e(t).combogrid("setValues",d),n.multiple||e(t).combogrid("hidePanel")}e.fn.combogrid=function(i,n){if("string"==typeof i){var o=e.fn.combogrid.methods[i];return o?o(this,n):this.combo(i,n)}return i=i||{},this.each(function(){var n=e.data(this,"combogrid");n?e.extend(n.options,i):n=e.data(this,"combogrid",{options:e.extend({},e.fn.combogrid.defaults,e.fn.combogrid.parseOptions(this),i)}),t(this)})},e.fn.combogrid.methods={options:function(t){var i=t.combo("options");return e.extend(e.data(t[0],"combogrid").options,{width:i.width,height:i.height,originalValue:i.originalValue,disabled:i.disabled,readonly:i.readonly})},grid:function(t){return e.data(t[0],"combogrid").grid},setValues:function(t,i){return t.each(function(){var t=e(this).combogrid("options");e.isArray(i)&&(i=e.map(i,function(i){return i&&"object"==typeof i?(e.easyui.addArrayItem(t.mappingRows,t.idField,i),i[t.idField]):i})),n(this,i)})},setValue:function(t,i){return t.each(function(){e(this).combogrid("setValues",e.isArray(i)?i:[i])})},clear:function(t){return t.each(function(){e(this).combogrid("setValues",[])})},reset:function(t){return t.each(function(){var t=e(this).combogrid("options");t.multiple?e(this).combogrid("setValues",t.originalValue):e(this).combogrid("setValue",t.originalValue)})}},e.fn.combogrid.parseOptions=function(t){e(t);return e.extend({},e.fn.combo.parseOptions(t),e.fn.datagrid.parseOptions(t),e.parser.parseOptions(t,["idField","textField","mode"]))},e.fn.combogrid.defaults=e.extend({},e.fn.combo.defaults,e.fn.datagrid.defaults,{height:22,loadMsg:null,idField:null,textField:null,unselectedValues:[],mappingRows:[],mode:"local",keyHandler:{up:function(e){i(this,"prev"),e.preventDefault()},down:function(e){i(this,"next"),e.preventDefault()},left:function(e){},right:function(e){},enter:function(e){a(this)},query:function(e,t){o(this,e)}},filter:function(t,i){var n=e(this).combogrid("options");return(i[n.textField]||"").toLowerCase().indexOf(t.toLowerCase())>=0}})}(jQuery);