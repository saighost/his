!function(e){function t(t){var r=e.data(t,"combotree"),a=r.options,i=r.tree;e(t).addClass("combotree-f"),e(t).combo(e.extend({},a,{onShowPanel:function(){a.editable&&i.tree("doFilter",""),a.onShowPanel.call(this)}}));var c=e(t).combo("panel");i||(i=e("<ul></ul>").appendTo(c),r.tree=i),i.tree(e.extend({},a,{checkbox:a.multiple,onLoadSuccess:function(o,c){var s=e(t).combotree("getValues");a.multiple&&e.map(i.tree("getChecked"),function(t){e.easyui.addArrayItem(s,t.id)}),n(t,s,r.remainText),a.onLoadSuccess.call(this,o,c)},onClick:function(n){a.multiple?e(this).tree(n.checked?"uncheck":"check",n.target):e(t).combo("hidePanel"),r.remainText=!1,o(t),a.onClick.call(this,n)},onCheck:function(e,n){r.remainText=!1,o(t),a.onCheck.call(this,e,n)}}))}function o(t){var o=e.data(t,"combotree"),r=o.options,a=o.tree,i=[];if(r.multiple)i=e.map(a.tree("getChecked"),function(e){return e.id});else{var c=a.tree("getSelected");c&&i.push(c.id)}i=i.concat(r.unselectedValues),n(t,i,o.remainText)}function n(t,o,n){function r(t,o){var n=e.easyui.getArrayItem(o,"id",t);return n?n.text:void 0}var a=e.data(t,"combotree"),i=a.options,c=a.tree,s=c.tree("options"),u=s.onBeforeCheck,l=s.onCheck,d=s.onSelect;s.onBeforeCheck=s.onCheck=s.onSelect=function(){},e.isArray(o)||(o=o.split(i.separator)),i.multiple||(o=o.length?[o[0]]:[""]);var m=e.map(o,function(e){return String(e)});c.find("div.tree-node-selected").removeClass("tree-node-selected"),e.map(c.tree("getChecked"),function(t){e.inArray(String(t.id),m)==-1&&c.tree("uncheck",t.target)});var f=[];if(i.unselectedValues=[],e.map(m,function(e){var t=c.tree("find",e);t?(c.tree("check",t.target).tree("select",t.target),f.push(t.text)):(f.push(r(e,i.mappingRows)||e),i.unselectedValues.push(e))}),i.multiple&&e.map(c.tree("getChecked"),function(t){var o=String(t.id);e.inArray(o,m)==-1&&(m.push(o),f.push(t.text))}),s.onBeforeCheck=u,s.onCheck=l,s.onSelect=d,!n){var h=f.join(i.separator);e(t).combo("getText")!=h&&e(t).combo("setText",h)}e(t).combo("setValues",m)}function r(t,o){var n=e.data(t,"combotree"),r=n.options,a=n.tree;n.remainText=!0,a.tree("doFilter",r.multiple?o.split(r.separator):o)}function a(t){var o=e.data(t,"combotree");o.remainText=!1,e(t).combotree("setValues",e(t).combotree("getValues")),e(t).combotree("hidePanel")}e.fn.combotree=function(o,n){if("string"==typeof o){var r=e.fn.combotree.methods[o];return r?r(this,n):this.combo(o,n)}return o=o||{},this.each(function(){var n=e.data(this,"combotree");n?e.extend(n.options,o):e.data(this,"combotree",{options:e.extend({},e.fn.combotree.defaults,e.fn.combotree.parseOptions(this),o)}),t(this)})},e.fn.combotree.methods={options:function(t){var o=t.combo("options");return e.extend(e.data(t[0],"combotree").options,{width:o.width,height:o.height,originalValue:o.originalValue,disabled:o.disabled,readonly:o.readonly})},clone:function(t,o){var n=t.combo("clone",o);return n.data("combotree",{options:e.extend(!0,{},t.combotree("options")),tree:t.combotree("tree")}),n},tree:function(t){return e.data(t[0],"combotree").tree},loadData:function(t,o){return t.each(function(){var t=e.data(this,"combotree").options;t.data=o;var n=e.data(this,"combotree").tree;n.tree("loadData",o)})},reload:function(t,o){return t.each(function(){var t=e.data(this,"combotree").options,n=e.data(this,"combotree").tree;o&&(t.url=o),n.tree({url:t.url})})},setValues:function(t,o){return t.each(function(){var t=e(this).combotree("options");e.isArray(o)&&(o=e.map(o,function(o){return o&&"object"==typeof o?(e.easyui.addArrayItem(t.mappingRows,"id",o),o.id):o})),n(this,o)})},setValue:function(t,o){return t.each(function(){e(this).combotree("setValues",e.isArray(o)?o:[o])})},clear:function(t){return t.each(function(){e(this).combotree("setValues",[])})},reset:function(t){return t.each(function(){var t=e(this).combotree("options");t.multiple?e(this).combotree("setValues",t.originalValue):e(this).combotree("setValue",t.originalValue)})}},e.fn.combotree.parseOptions=function(t){return e.extend({},e.fn.combo.parseOptions(t),e.fn.tree.parseOptions(t))},e.fn.combotree.defaults=e.extend({},e.fn.combo.defaults,e.fn.tree.defaults,{editable:!1,unselectedValues:[],mappingRows:[],keyHandler:{up:function(e){},down:function(e){},left:function(e){},right:function(e){},enter:function(e){a(this)},query:function(e,t){r(this,e)}}})}(jQuery);