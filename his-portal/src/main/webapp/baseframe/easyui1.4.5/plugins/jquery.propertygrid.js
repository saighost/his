!function(t){function r(r){var d=(t.data(r,"propertygrid"),t.data(r,"propertygrid").options);t(r).datagrid(t.extend({},d,{cls:"propertygrid",view:d.showGroup?d.groupView:d.view,onBeforeEdit:function(a,e){if(0==d.onBeforeEdit.call(r,a,e))return!1;var i=t(this),e=i.datagrid("getRows")[a],o=i.datagrid("getColumnOption","value");o.editor=e.editor},onClickCell:function(i,o,n){if(e!=this&&(a(e),e=this),d.editIndex!=i){a(e),t(this).datagrid("beginEdit",i);var s=t(this).datagrid("getEditor",{index:i,field:o});if(s||(s=t(this).datagrid("getEditor",{index:i,field:"value"})),s){var p=t(s.target),l=p.data("textbox")?p.textbox("textbox"):p;l.focus(),d.editIndex=i}}d.onClickCell.call(r,i,o,n)},loadFilter:function(t){return a(this),d.loadFilter.call(this,t)}}))}function a(r){var a=t(r);if(a.length){var e=t.data(r,"propertygrid").options;e.finder.getTr(r,null,"editing").each(function(){var r=parseInt(t(this).attr("datagrid-row-index"));a.datagrid("validateRow",r)?a.datagrid("endEdit",r):a.datagrid("cancelEdit",r)}),e.editIndex=void 0}}var e;t(document).unbind(".propertygrid").bind("mousedown.propertygrid",function(r){var d=t(r.target).closest("div.datagrid-view,div.combo-panel");d.length||(a(e),e=void 0)}),t.fn.propertygrid=function(a,e){if("string"==typeof a){var d=t.fn.propertygrid.methods[a];return d?d(this,e):this.datagrid(a,e)}return a=a||{},this.each(function(){var e=t.data(this,"propertygrid");if(e)t.extend(e.options,a);else{var d=t.extend({},t.fn.propertygrid.defaults,t.fn.propertygrid.parseOptions(this),a);d.frozenColumns=t.extend(!0,[],d.frozenColumns),d.columns=t.extend(!0,[],d.columns),t.data(this,"propertygrid",{options:d})}r(this)})},t.fn.propertygrid.methods={options:function(r){return t.data(r[0],"propertygrid").options}},t.fn.propertygrid.parseOptions=function(r){return t.extend({},t.fn.datagrid.parseOptions(r),t.parser.parseOptions(r,[{showGroup:"boolean"}]))};var d=t.extend({},t.fn.datagrid.defaults.view,{render:function(r,a,e){for(var d=[],i=this.groups,o=0;o<i.length;o++)d.push(this.renderGroup.call(this,r,o,i[o],e));t(a).html(d.join(""))},renderGroup:function(r,a,e,d){var i=t.data(r,"datagrid"),o=i.options,n=t(r).datagrid("getColumnFields",d),s=[];s.push('<div class="datagrid-group" group-index='+a+">"),(d&&(o.rownumbers||o.frozenColumns.length)||!d&&!o.rownumbers&&!o.frozenColumns.length)&&(s.push('<span class="datagrid-group-expander">'),s.push('<span class="datagrid-row-expander datagrid-row-collapse">&nbsp;</span>'),s.push("</span>")),d||(s.push('<span class="datagrid-group-title">'),s.push(o.groupFormatter.call(r,e.value,e.rows)),s.push("</span>")),s.push("</div>"),s.push('<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>');for(var p=e.startIndex,l=0;l<e.rows.length;l++){var g=o.rowStyler?o.rowStyler.call(r,p,e.rows[l]):"",u="",h="";"string"==typeof g?h=g:g&&(u=g["class"]||"",h=g.style||"");var c='class="datagrid-row '+(p%2&&o.striped?"datagrid-row-alt ":" ")+u+'"',f=h?'style="'+h+'"':"",v=i.rowIdPrefix+"-"+(d?1:2)+"-"+p;s.push('<tr id="'+v+'" datagrid-row-index="'+p+'" '+c+" "+f+">"),s.push(this.renderRow.call(this,r,n,d,p,e.rows[l])),s.push("</tr>"),p++}return s.push("</tbody></table>"),s.join("")},bindEvents:function(r){var a=t.data(r,"datagrid"),e=a.dc,d=e.body1.add(e.body2),i=(t.data(d[0],"events")||t._data(d[0],"events")).click[0].handler;d.unbind("click").bind("click",function(a){var e=t(a.target),d=e.closest("span.datagrid-row-expander");if(d.length){var o=d.closest("div.datagrid-group").attr("group-index");d.hasClass("datagrid-row-collapse")?t(r).datagrid("collapseGroup",o):t(r).datagrid("expandGroup",o)}else i(a);a.stopPropagation()})},onBeforeRender:function(r,a){function e(t){for(var r=0;r<n.length;r++){var a=n[r];if(a.value==t)return a}return null}function d(){t("#datagrid-group-style").length||t("head").append('<style id="datagrid-group-style">.datagrid-group{height:'+o.groupHeight+"px;overflow:hidden;font-weight:bold;border-bottom:1px solid #ccc;}.datagrid-group-title,.datagrid-group-expander{display:inline-block;vertical-align:bottom;height:100%;line-height:"+o.groupHeight+"px;padding:0 4px;}.datagrid-group-expander{width:"+o.expanderWidth+"px;text-align:center;padding:0}.datagrid-row-expander{margin:"+Math.floor((o.groupHeight-16)/2)+"px 0;display:inline-block;width:16px;height:16px;cursor:pointer}</style>")}var i=t.data(r,"datagrid"),o=i.options;d();for(var n=[],s=0;s<a.length;s++){var p=a[s],l=e(p[o.groupField]);l?l.rows.push(p):(l={value:p[o.groupField],rows:[p]},n.push(l))}for(var g=0,u=[],s=0;s<n.length;s++){var l=n[s];l.startIndex=g,g+=l.rows.length,u=u.concat(l.rows)}i.data.rows=u,this.groups=n;var h=this;setTimeout(function(){h.bindEvents(r)},0)}});t.extend(t.fn.datagrid.methods,{groups:function(t){return t.datagrid("options").view.groups},expandGroup:function(r,a){return r.each(function(){var r=t.data(this,"datagrid").dc.view,e=r.find(void 0!=a?'div.datagrid-group[group-index="'+a+'"]':"div.datagrid-group"),d=e.find("span.datagrid-row-expander");d.hasClass("datagrid-row-expand")&&(d.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse"),e.next("table").show()),t(this).datagrid("fixRowHeight")})},collapseGroup:function(r,a){return r.each(function(){var r=t.data(this,"datagrid").dc.view,e=r.find(void 0!=a?'div.datagrid-group[group-index="'+a+'"]':"div.datagrid-group"),d=e.find("span.datagrid-row-expander");d.hasClass("datagrid-row-collapse")&&(d.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand"),e.next("table").hide()),t(this).datagrid("fixRowHeight")})}}),t.extend(d,{refreshGroupTitle:function(r,a){var e=t.data(r,"datagrid"),d=e.options,i=e.dc,o=this.groups[a],n=i.body2.children("div.datagrid-group[group-index="+a+"]").find("span.datagrid-group-title");n.html(d.groupFormatter.call(r,o.value,o.rows))},insertRow:function(r,a,e){function d(t,a){var e=a?1:2,d=n.finder.getTr(r,t-1,"body",e),i=n.finder.getTr(r,t,"body",e);i.insertAfter(d)}var i,o=t.data(r,"datagrid"),n=o.options,s=o.dc,p=null;if(!o.data.rows.length)return void t(r).datagrid("loadData",[e]);for(var l=0;l<this.groups.length;l++)if(this.groups[l].value==e[n.groupField]){p=this.groups[l],i=l;break}p?(void 0!=a&&null!=a||(a=o.data.rows.length),a<p.startIndex?a=p.startIndex:a>p.startIndex+p.rows.length&&(a=p.startIndex+p.rows.length),t.fn.datagrid.defaults.view.insertRow.call(this,r,a,e),a>=p.startIndex+p.rows.length&&(d(a,!0),d(a,!1)),p.rows.splice(a-p.startIndex,0,e)):(p={value:e[n.groupField],rows:[e],startIndex:o.data.rows.length},i=this.groups.length,s.body1.append(this.renderGroup.call(this,r,i,p,!0)),s.body2.append(this.renderGroup.call(this,r,i,p,!1)),this.groups.push(p),o.data.rows.push(e)),this.refreshGroupTitle(r,i)},updateRow:function(r,a,e){var d=t.data(r,"datagrid").options;t.fn.datagrid.defaults.view.updateRow.call(this,r,a,e);var i=d.finder.getTr(r,a,"body",2).closest("table.datagrid-btable"),o=parseInt(i.prev().attr("group-index"));this.refreshGroupTitle(r,o)},deleteRow:function(r,a){var e=t.data(r,"datagrid"),d=e.options,i=e.dc,o=i.body1.add(i.body2),n=d.finder.getTr(r,a,"body",2).closest("table.datagrid-btable"),s=parseInt(n.prev().attr("group-index"));t.fn.datagrid.defaults.view.deleteRow.call(this,r,a);var p=this.groups[s];if(p.rows.length>1)p.rows.splice(a-p.startIndex,1),this.refreshGroupTitle(r,s);else{o.children("div.datagrid-group[group-index="+s+"]").remove();for(var l=s+1;l<this.groups.length;l++)o.children("div.datagrid-group[group-index="+l+"]").attr("group-index",l-1);this.groups.splice(s,1)}for(var a=0,l=0;l<this.groups.length;l++){var p=this.groups[l];p.startIndex=a,a+=p.rows.length}}}),t.fn.propertygrid.defaults=t.extend({},t.fn.datagrid.defaults,{groupHeight:21,expanderWidth:16,singleSelect:!0,remoteSort:!1,fitColumns:!0,loadMsg:"",frozenColumns:[[{field:"f",width:16,resizable:!1}]],columns:[[{field:"name",title:"Name",width:100,sortable:!0},{field:"value",title:"Value",width:100,resizable:!1}]],showGroup:!1,groupView:d,groupField:"group",groupFormatter:function(t,r){return t}})}(jQuery);